<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NASA Top 25 Meteorite Mass Pie Chart</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .legend {
      font-family: Arial, sans-serif;
      font-size: 12px;
    }
  </style>
</head>
<body>

<div id="chart"></div>
<div id="legend" class="legend"></div>

<script>


const width = 400;
const height = 400;
const radius = Math.min(width, height) / 2;


const svg = d3.select("#chart")
  .append("svg")
  .attr("width", width)
  .attr("height", height)
  .append("g")
  .attr("transform", `translate(${width / 2},${height / 2})`);

const legend = d3.select("#legend");

const apiUrl = 'https://data.nasa.gov/resource/gh4g-9sfh.json';


fetch(apiUrl)
  .then(response => response.json())
  .then(data => {
    
    data.forEach(item => {
      item.mass_numeric = parseFloat(item.mass) || 0;
    });

    
    const sortedData = data.sort((a, b) => b.mass_numeric - a.mass_numeric).slice(0, 25);

    
    const massValues = sortedData.map(d => d.mass_numeric);
    const totalMass = d3.sum(massValues);
    const massPercentage = massValues.map(value => (value / totalMass) * 100);

    
    const pie = d3.pie();
    const arc = d3.arc().innerRadius(0).outerRadius(radius);

    
    const slices = svg.selectAll("slice")
      .data(pie(massPercentage))
      .enter()
      .append("g");

    const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

    slices.append("path")
      .attr("d", arc)
      .attr("fill", (d, i) => colorScale(i))
      .attr("stroke", "white")
      .attr("stroke-width", 2);

    
    slices.append("text")
      .attr("transform", d => `translate(${arc.centroid(d)})`)
      .attr("text-anchor", "middle")
      .text((d, i) => `${sortedData[i].name}`)
      .style("fill", "white");

    
    const legendItems = legend.selectAll(".legend-item")
      .data(sortedData.map((d, i) => ({ name: d.name, color: colorScale(i) })))
      .enter()
      .append("div")
      .attr("class", "legend-item");

    legendItems.append("div")
      .attr("class", "legend-color")
      .style("background-color", d => d.color);

    legendItems.append("div")
      .attr("class", "legend-label")
      .text(d => d.name);

  })
  .catch(error => {
    console.error('Error fetching data:', error);
  });

</script>

</body>
</html>